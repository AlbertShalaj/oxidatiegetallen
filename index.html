<!DOCTYPE html>
<html lang="nl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oxidatiegetal-Bepaler | LPD 28C</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body {
            background: #f8fafc;
            font-family: 'Nunito', sans-serif;
            margin: 0;
            padding: 0;
        }

        .input-cell {
            transition: all 0.2s;
        }

        .input-cell:focus {
            transform: scale(1.05);
            border-color: #f97316;
            box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.2);
        }
    </style>
</head>

<body class="min-h-screen w-full bg-gray-50">
    <div id="root" class="w-full h-full"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        // Converteer getal naar romeins cijfer
        const toRoman = (num) => {
            if (num === 0 || num === '0') return '0';
            if (!num) return '';
            const sign = num < 0 ? '-' : '+';
            const absNum = Math.abs(num);
            const map = [[10, 'X'], [9, 'IX'], [8, 'VIII'], [7, 'VII'], [6, 'VI'], [5, 'V'], [4, 'IV'], [3, 'III'], [2, 'II'], [1, 'I']];
            for (const [val, rom] of map) if (absNum === val) return sign + rom;
            return sign + absNum;
        };

        const fromRoman = (str) => {
            if (!str) return null;
            str = str.toUpperCase().trim();
            if (str === '0') return 0;
            const romanToNum = { 'I': 1, 'II': 2, 'III': 3, 'IV': 4, 'V': 5, 'VI': 6, 'VII': 7, 'VIII': 8, 'IX': 9, 'X': 10 };
            if (str.startsWith('-')) {
                const val = romanToNum[str.substring(1)];
                return val ? -val : null;
            }
            if (str.startsWith('+')) str = str.substring(1);
            return romanToNum[str] || parseInt(str) || null;
        };

        const COMPOUNDS = {
            easy: [
                { formula: 'H‚ÇÇO', name: 'Water', charge: 0, atoms: [{ el: 'H', n: 2, ox: 1 }, { el: 'O', n: 1, ox: -2 }], hint: 'H is meestal +I, O is -II.' },
                { formula: 'CO‚ÇÇ', name: 'Koolstofdioxide', charge: 0, atoms: [{ el: 'C', n: 1, ox: 4 }, { el: 'O', n: 2, ox: -2 }], hint: 'O is meestal -II. Totale lading is 0.' },
                { formula: 'NH‚ÇÉ', name: 'Ammoniak', charge: 0, atoms: [{ el: 'N', n: 1, ox: -3 }, { el: 'H', n: 3, ox: 1 }], hint: 'H is meestal +I.' },
                { formula: 'CH‚ÇÑ', name: 'Methaan', charge: 0, atoms: [{ el: 'C', n: 1, ox: -4 }, { el: 'H', n: 4, ox: 1 }], hint: 'H is meestal +I.' },
                { formula: 'HCl', name: 'Waterstofchloride', charge: 0, atoms: [{ el: 'H', n: 1, ox: 1 }, { el: 'Cl', n: 1, ox: -1 }], hint: 'H is +I, Cl is -I.' },
                { formula: 'NaCl', name: 'Natriumchloride', charge: 0, atoms: [{ el: 'Na', n: 1, ox: 1 }, { el: 'Cl', n: 1, ox: -1 }], hint: 'Na (groep Ia) is +I.' },
                { formula: 'Fe‚ÇÇO‚ÇÉ', name: 'IJzer(III)oxide', charge: 0, atoms: [{ el: 'Fe', n: 2, ox: 3 }, { el: 'O', n: 3, ox: -2 }], hint: 'O=-II. Bereken Fe.' },
                { formula: 'SO‚ÇÇ', name: 'Zwaveldioxide', charge: 0, atoms: [{ el: 'S', n: 1, ox: 4 }, { el: 'O', n: 2, ox: -2 }], hint: 'O=-II.' },
                { formula: 'MgO', name: 'Magnesiumoxide', charge: 0, atoms: [{ el: 'Mg', n: 1, ox: 2 }, { el: 'O', n: 1, ox: -2 }], hint: 'Mg (groep IIa) is +II.' },
                { formula: 'Al‚ÇÇO‚ÇÉ', name: 'Aluminiumoxide', charge: 0, atoms: [{ el: 'Al', n: 2, ox: 3 }, { el: 'O', n: 3, ox: -2 }], hint: 'Al (groep IIIa) is +III.' }
            ],
            hard: [
                { formula: 'H‚ÇÇSO‚ÇÑ', name: 'Zwavelzuur', charge: 0, atoms: [{ el: 'H', n: 2, ox: 1 }, { el: 'S', n: 1, ox: 6 }, { el: 'O', n: 4, ox: -2 }], hint: 'H=+I, O=-II. Totale lading is 0.' },
                { formula: 'HNO‚ÇÉ', name: 'Salpeterzuur', charge: 0, atoms: [{ el: 'H', n: 1, ox: 1 }, { el: 'N', n: 1, ox: 5 }, { el: 'O', n: 3, ox: -2 }], hint: 'H=+I, O=-II. Totale lading is 0.' },
                { formula: 'KMnO‚ÇÑ', name: 'Kaliumpermanganaat', charge: 0, atoms: [{ el: 'K', n: 1, ox: 1 }, { el: 'Mn', n: 1, ox: 7 }, { el: 'O', n: 4, ox: -2 }], hint: 'K (groep Ia) = +I, O=-II.' },
                { formula: 'K‚ÇÇCr‚ÇÇO‚Çá', name: 'Kaliumdichromaat', charge: 0, atoms: [{ el: 'K', n: 2, ox: 1 }, { el: 'Cr', n: 2, ox: 6 }, { el: 'O', n: 7, ox: -2 }], hint: 'K=+I, O=-II.' },
                { formula: 'SO‚ÇÑ¬≤‚Åª', name: 'Sulfaat-ion', charge: -2, atoms: [{ el: 'S', n: 1, ox: 6 }, { el: 'O', n: 4, ox: -2 }], hint: 'O=-II. Totale lading is -2!' },
                { formula: 'NO‚ÇÉ‚Åª', name: 'Nitraat-ion', charge: -1, atoms: [{ el: 'N', n: 1, ox: 5 }, { el: 'O', n: 3, ox: -2 }], hint: 'O=-II. Totale lading is -1!' },
                { formula: 'NH‚ÇÑ‚Å∫', name: 'Ammonium-ion', charge: 1, atoms: [{ el: 'N', n: 1, ox: -3 }, { el: 'H', n: 4, ox: 1 }], hint: 'H=+I. Totale lading is +1!' },
                { formula: 'PO‚ÇÑ¬≥‚Åª', name: 'Fosfaat-ion', charge: -3, atoms: [{ el: 'P', n: 1, ox: 5 }, { el: 'O', n: 4, ox: -2 }], hint: 'O=-II. Totale lading is -3!' },
                { formula: 'Cr‚ÇÇO‚Çá¬≤‚Åª', name: 'Dichromaat-ion', charge: -2, atoms: [{ el: 'Cr', n: 2, ox: 6 }, { el: 'O', n: 7, ox: -2 }], hint: 'O=-II. Totale lading is -2!' },
                { formula: 'MnO‚ÇÑ‚Åª', name: 'Permanganaat-ion', charge: -1, atoms: [{ el: 'Mn', n: 1, ox: 7 }, { el: 'O', n: 4, ox: -2 }], hint: 'O=-II. Totale lading is -1!' },
                { formula: 'ClO‚ÇÉ‚Åª', name: 'Chloraat-ion', charge: -1, atoms: [{ el: 'Cl', n: 1, ox: 5 }, { el: 'O', n: 3, ox: -2 }], hint: 'O=-II. Totale lading is -1!' },
                { formula: 'CO‚ÇÉ¬≤‚Åª', name: 'Carbonaat-ion', charge: -2, atoms: [{ el: 'C', n: 1, ox: 4 }, { el: 'O', n: 3, ox: -2 }], hint: 'O=-II. Totale lading is -2!' }
            ]
        };

        const App = () => {
            const [started, setStarted] = useState(false);
            const [currentCompound, setCurrentCompound] = useState(COMPOUNDS.easy[0]);
            const [inputs, setInputs] = useState({}); // { 'el_idx_field': value }
            const [feedback, setFeedback] = useState(null);
            const [showHint, setShowHint] = useState(false);

            const reset = (comp) => {
                setCurrentCompound(comp);
                setInputs({});
                setFeedback(null);
                setShowHint(false);
            };

            const handleInputChange = (idx, field, value) => {
                setInputs(prev => ({ ...prev, [`${idx}_${field}`]: value }));
            };

            const adjustOxidation = (idx, delta) => {
                const currentValStr = inputs[`${idx}_ox`];
                let currentVal = fromRoman(currentValStr);
                if (currentVal === null) currentVal = 0;

                const newVal = currentVal + delta;
                const newValStr = toRoman(newVal);

                handleInputChange(idx, 'ox', newValStr);
            };

            const checkAnswers = () => {
                let allCorrect = true;
                let totalSum = 0;

                // Check per atom
                currentCompound.atoms.forEach((atom, idx) => {
                    const inputOxStr = inputs[`${idx}_ox`];
                    const inputNStr = inputs[`${idx}_n`];

                    const inputOx = fromRoman(inputOxStr);
                    const inputN = parseInt(inputNStr);

                    if (inputOx !== atom.ox || inputN !== atom.n) {
                        allCorrect = false;
                    }

                    if (inputOx !== null && !isNaN(inputN)) {
                        totalSum += inputOx * inputN;
                    }
                });

                if (allCorrect) {
                    setFeedback({ type: 'success', msg: `Correct! De som is ${totalSum} en dat klopt met de lading (${currentCompound.charge}).` });
                    confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
                } else {
                    setFeedback({ type: 'error', msg: 'Nog niet helemaal juist. Controleer je oxidatiegetallen en aantallen.' });
                }
            };

            if (!started) {
                return (
                    <div className="min-h-screen w-full flex items-center justify-center bg-white">
                        <div className="p-8 rounded-3xl shadow-2xl max-w-md w-full text-center">
                            <div className="text-6xl mb-4">‚öõÔ∏è</div>
                            <h1 className="text-3xl font-bold mb-2 text-orange-600">Oxidatiegetal-Bepaler</h1>
                            <p className="text-gray-600 mb-6">Leer oxidatiegetallen bepalen met de tabel-methode!</p>
                            <button onClick={() => setStarted(true)} className="w-full py-4 rounded-xl font-bold text-lg text-white bg-orange-600 hover:bg-orange-700 transition">
                                Start Oefening üöÄ
                            </button>
                        </div>
                    </div>
                );
            }

            // Calculate current totals for display
            const currentTotals = currentCompound.atoms.map((atom, idx) => {
                const ox = fromRoman(inputs[`${idx}_ox`]);
                const n = parseInt(inputs[`${idx}_n`]);
                if (ox !== null && !isNaN(n)) return ox * n;
                return null;
            });

            const currentSum = currentTotals.reduce((acc, val) => acc + (val || 0), 0);

            return (
                <div className="bg-white min-h-screen w-full flex flex-col">
                    <div className="bg-gradient-to-r from-orange-600 to-red-600 p-6 text-white flex justify-between items-center shadow-md">
                        <div>
                            <h2 className="text-2xl font-bold">Oxidatiegetal Tabel</h2>
                            <p className="text-orange-100">Vul de tabel in om de oxidatiegetallen te vinden</p>
                        </div>
                        <div className="bg-white/20 px-4 py-2 rounded-lg">
                            <span className="font-bold">Lading: </span>
                            <span className="text-2xl font-mono">{currentCompound.charge > 0 ? '+' + currentCompound.charge : currentCompound.charge}</span>
                        </div>
                    </div>

                    <div className="p-8 flex-grow flex flex-col items-center">
                        {/* Compound Selection */}
                        <div className="mb-8 w-full max-w-4xl">
                            <h3 className="text-center text-gray-400 font-bold mb-3 uppercase text-sm tracking-wider">Makkelijk</h3>
                            <div className="flex flex-wrap gap-2 justify-center mb-6">
                                {COMPOUNDS.easy.map((comp, idx) => (
                                    <button
                                        key={idx}
                                        onClick={() => reset(comp)}
                                        className={`px-4 py-2 rounded-lg font-bold transition ${currentCompound === comp ? 'bg-green-600 text-white shadow-lg scale-105' : 'bg-green-50 text-green-700 hover:bg-green-100'}`}
                                    >
                                        {comp.formula}
                                    </button>
                                ))}
                            </div>

                            <h3 className="text-center text-gray-400 font-bold mb-3 uppercase text-sm tracking-wider">Moeilijk</h3>
                            <div className="flex flex-wrap gap-2 justify-center">
                                {COMPOUNDS.hard.map((comp, idx) => (
                                    <button
                                        key={idx}
                                        onClick={() => reset(comp)}
                                        className={`px-4 py-2 rounded-lg font-bold transition ${currentCompound === comp ? 'bg-orange-600 text-white shadow-lg scale-105' : 'bg-orange-50 text-orange-700 hover:bg-orange-100'}`}
                                    >
                                        {comp.formula}
                                    </button>
                                ))}
                            </div>
                        </div>

                        {/* Main Workspace */}
                        <div className="flex flex-col items-center w-full max-w-4xl">
                            <div className="text-6xl font-bold text-gray-800 mb-2 font-mono">{currentCompound.formula}</div>
                            <div className="text-gray-500 mb-8">{currentCompound.name}</div>

                            {/* The Table */}
                            <div className="w-full overflow-x-auto mb-6">
                                <table className="w-full border-collapse text-center">
                                    <thead>
                                        <tr>
                                            <th className="p-4 text-left text-gray-400 font-normal w-32">Atoomsoort</th>
                                            {currentCompound.atoms.map((atom, idx) => (
                                                <th key={idx} className="p-4 text-2xl font-bold text-gray-700 border-b-2 border-orange-100 bg-orange-50/50">
                                                    {atom.el}
                                                </th>
                                            ))}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {/* Row 1: Oxidatiegetal */}
                                        <tr>
                                            <td className="p-4 text-left font-bold text-gray-600">Oxidatiegetal (OG)</td>
                                            {currentCompound.atoms.map((atom, idx) => (
                                                <td key={idx} className="p-2 relative">
                                                    <div className="relative inline-block">
                                                        <input
                                                            type="text"
                                                            placeholder="bv. -II"
                                                            className="input-cell w-24 text-center p-2 pr-8 border-2 border-gray-300 rounded-lg font-bold text-lg text-orange-600 outline-none placeholder-gray-300 uppercase relative z-10 bg-white"
                                                            value={inputs[`${idx}_ox`] || ''}
                                                            onChange={(e) => handleInputChange(idx, 'ox', e.target.value)}
                                                        />
                                                        <div className="absolute right-1 top-1/2 -translate-y-1/2 flex flex-col gap-0.5 z-20">
                                                            <button
                                                                onClick={() => adjustOxidation(idx, 1)}
                                                                className="w-5 h-4 flex items-center justify-center bg-orange-100 hover:bg-orange-200 rounded text-[10px] text-orange-700 leading-none transition-colors"
                                                            >
                                                                ‚ñ≤
                                                            </button>
                                                            <button
                                                                onClick={() => adjustOxidation(idx, -1)}
                                                                className="w-5 h-4 flex items-center justify-center bg-orange-100 hover:bg-orange-200 rounded text-[10px] text-orange-700 leading-none transition-colors"
                                                            >
                                                                ‚ñº
                                                            </button>
                                                        </div>
                                                    </div>
                                                    {/* Connector line start */}
                                                    <div className="absolute bottom-0 left-1/2 w-0.5 h-4 bg-gray-300 -translate-x-1/2"></div>
                                                </td>
                                            ))}
                                        </tr>
                                        {/* Row 2: Arrow & Aantal */}
                                        <tr>
                                            <td className="p-4 text-left font-bold text-gray-400"></td>
                                            {currentCompound.atoms.map((atom, idx) => (
                                                <td key={idx} className="p-0 h-24 align-middle">
                                                    <div className="flex flex-col items-center justify-center h-full relative">
                                                        {/* Arrow Line */}
                                                        <div className="absolute top-0 bottom-0 w-0.5 bg-gray-300"></div>
                                                        {/* Arrow Head */}
                                                        <div className="absolute bottom-0 text-gray-300 text-sm -mb-1">‚ñº</div>

                                                        {/* Input Container on the side */}
                                                        <div className="relative z-10 bg-white px-2 py-1 flex items-center gap-2 border border-gray-200 rounded-lg shadow-sm transform translate-x-8">
                                                            <div className="absolute -top-3 left-1/2 -translate-x-1/2 text-[10px] text-gray-400 font-bold bg-white px-1 whitespace-nowrap">Aantal</div>
                                                            <span className="text-gray-400 font-bold text-sm">√ó</span>
                                                            <input
                                                                type="number"
                                                                placeholder="n"
                                                                className="input-cell w-12 text-center p-1 border border-gray-300 rounded font-bold text-blue-600 outline-none placeholder-gray-300"
                                                                value={inputs[`${idx}_n`] || ''}
                                                                onChange={(e) => handleInputChange(idx, 'n', e.target.value)}
                                                            />
                                                        </div>
                                                    </div>
                                                </td>
                                            ))}
                                        </tr>
                                        {/* Row 3: Totaal */}
                                        <tr className="bg-gray-50">
                                            <td className="p-4 text-left font-bold text-gray-600">Totaal (OG √ó n)</td>
                                            {currentCompound.atoms.map((atom, idx) => (
                                                <td key={idx} className="p-4 font-mono text-xl font-bold text-gray-800">
                                                    {currentTotals[idx] !== null ? currentTotals[idx] : '-'}
                                                </td>
                                            ))}
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            {/* Sum Check */}
                            <div className={`flex items-center gap-4 px-6 py-3 rounded-xl border-2 mb-6 transition-all ${currentSum === currentCompound.charge ? 'border-green-200 bg-green-50' : 'border-gray-200 bg-gray-50'}`}>
                                <span className="text-gray-500 font-bold">Totale Som:</span>
                                <span className={`text-2xl font-mono font-bold ${currentSum === currentCompound.charge ? 'text-green-600' : 'text-gray-600'}`}>
                                    {currentSum}
                                </span>
                                <span className="text-gray-400">moet gelijk zijn aan</span>
                                <span className="text-xl font-mono font-bold text-purple-600">
                                    {currentCompound.charge}
                                </span>
                                {currentSum === currentCompound.charge && <span className="text-green-500 text-xl">‚úì</span>}
                            </div>

                            {/* Controls */}
                            <div className="flex gap-4 w-full max-w-md">
                                <button
                                    onClick={() => setShowHint(!showHint)}
                                    className="flex-1 py-3 px-6 rounded-xl font-bold text-blue-600 bg-blue-50 hover:bg-blue-100 border-2 border-blue-100 transition"
                                >
                                    {showHint ? 'Verberg Hint' : 'üí° Hint'}
                                </button>
                                <button
                                    onClick={checkAnswers}
                                    className="flex-1 py-3 px-6 rounded-xl font-bold text-white bg-orange-600 hover:bg-orange-700 shadow-lg hover:shadow-xl transition transform hover:-translate-y-1"
                                >
                                    Controleer
                                </button>
                            </div>

                            {/* Feedback & Hint */}
                            {showHint && (
                                <div className="mt-4 p-4 bg-blue-50 text-blue-800 rounded-xl border border-blue-200 max-w-md text-center animate-fade-in">
                                    {currentCompound.hint}
                                </div>
                            )}

                            {feedback && (
                                <div className={`mt-4 p-4 rounded-xl border-2 font-bold text-center max-w-md animate-bounce-in ${feedback.type === 'success' ? 'bg-green-50 border-green-200 text-green-700' : 'bg-red-50 border-red-200 text-red-700'}`}>
                                    {feedback.msg}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
    <style>
        @keyframes fade-in {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in {
            animation: fade-in 0.3s ease-out;
        }

        @keyframes bounce-in {
            0% {
                opacity: 0;
                transform: scale(0.9);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        .animate-bounce-in {
            animation: bounce-in 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
    </style>
</body>

</html>