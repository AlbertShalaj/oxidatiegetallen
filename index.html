<!DOCTYPE html>
<html lang="nl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oxidatiegetal Bepaler</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Fonts: Inter for UI, Roboto Mono for numbers/formulas -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Roboto+Mono:wght@400;500;700&display=swap"
        rel="stylesheet">

    <style>
        :root {
            --cpk-c: #333333;
            --cpk-h: #F5F5F5;
            /* Displayed as dark grey border/text usually */
            --cpk-o: #F00000;
            --cpk-n: #3050F8;
            --cpk-s: #FFFF30;
            --cpk-p: #FFA500;
            --cpk-k: #8F40D4;
            --cpk-mn: #9C7AC7;
            --cpk-fe: #E06633;
            --cpk-cr: #8A99C7;
            --cpk-default: #DDDDDD;
        }

        body {
            background-color: #F9FAFB;
            /* Neutral off-white */
            font-family: 'Inter', sans-serif;
            color: #111827;
            -webkit-font-smoothing: antialiased;
        }

        .font-mono {
            font-family: 'Roboto Mono', monospace;
        }

        /* Custom Focus Ring for Accessibility */
        *:focus-visible {
            outline: 2px solid #2563EB;
            outline-offset: 2px;
        }

        .input-cell {
            transition: border-color 0.15s ease, box-shadow 0.15s ease;
        }

        .input-cell:focus {
            border-color: #2563EB;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* CPK Color Classes */
        .cpk-bg-C {
            background-color: var(--cpk-c);
            color: white;
        }

        .cpk-bg-H {
            background-color: #ffffff;
            color: #333;
            border: 2px solid #e5e7eb;
        }

        .cpk-bg-O {
            background-color: var(--cpk-o);
            color: white;
        }

        .cpk-bg-N {
            background-color: var(--cpk-n);
            color: white;
        }

        .cpk-bg-S {
            background-color: var(--cpk-s);
            color: black;
        }

        .cpk-bg-P {
            background-color: var(--cpk-p);
            color: black;
        }

        .cpk-bg-K {
            background-color: var(--cpk-k);
            color: white;
        }

        .cpk-bg-Mn {
            background-color: var(--cpk-mn);
            color: white;
        }

        .cpk-bg-Fe {
            background-color: var(--cpk-fe);
            color: white;
        }

        .cpk-bg-Cr {
            background-color: var(--cpk-cr);
            color: white;
        }

        /* Animation for correct answer */
        @keyframes pulse-green {
            0% {
                box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(34, 197, 94, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(34, 197, 94, 0);
            }
        }

        .animate-success {
            animation: pulse-green 1s ease-out;
        }
    </style>
</head>

<body class="min-h-screen flex flex-col items-center py-12 px-4">
    <div id="root" class="w-full max-w-4xl"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- Utilities ---

        const toRoman = (num) => {
            if (num === 0 || num === '0') return '0';
            if (!num) return '';
            const sign = num < 0 ? '-' : '';
            const absNum = Math.abs(num);
            const map = [[10, 'X'], [9, 'IX'], [8, 'VIII'], [7, 'VII'], [6, 'VI'], [5, 'V'], [4, 'IV'], [3, 'III'], [2, 'II'], [1, 'I']];
            for (const [val, rom] of map) if (absNum === val) return sign + rom;
            return sign + absNum;
        };

        const fromRoman = (str) => {
            if (!str) return null;
            str = str.toUpperCase().trim();
            if (str === '0') return 0;
            const romanToNum = { 'I': 1, 'II': 2, 'III': 3, 'IV': 4, 'V': 5, 'VI': 6, 'VII': 7, 'VIII': 8, 'IX': 9, 'X': 10 };

            // Handle negative roman numerals (e.g. -II)
            let sign = 1;
            if (str.startsWith('-')) {
                sign = -1;
                str = str.substring(1);
            } else if (str.startsWith('+')) {
                str = str.substring(1);
            }

            const val = romanToNum[str];
            if (val) return val * sign;

            // Fallback for normal numbers
            const parsed = parseInt(str);
            return isNaN(parsed) ? null : parsed * sign;
        };

        // --- Data ---

        const COMPOUNDS = [
            {
                id: 'co2',
                formula: <span>CO<sub>2</sub></span>,
                plainFormula: 'CO2',
                name: 'Koolstofdioxide',
                charge: 0,
                atoms: [
                    { el: 'C', n: 1, ox: 4, cpk: 'C' },
                    { el: 'O', n: 2, ox: -2, cpk: 'O' }
                ],
                hint: 'Zuurstof (O) heeft meestal oxidatiegetal -II.'
            },
            {
                id: 'h2so4',
                formula: <span>H<sub>2</sub>SO<sub>4</sub></span>,
                plainFormula: 'H2SO4',
                name: 'Zwavelzuur',
                charge: 0,
                atoms: [
                    { el: 'H', n: 2, ox: 1, cpk: 'H' },
                    { el: 'S', n: 1, ox: 6, cpk: 'S' },
                    { el: 'O', n: 4, ox: -2, cpk: 'O' }
                ],
                hint: 'Waterstof (H) is +I, Zuurstof (O) is -II.'
            },
            {
                id: 'hno3',
                formula: <span>HNO<sub>3</sub></span>,
                plainFormula: 'HNO3',
                name: 'Salpeterzuur',
                charge: 0,
                atoms: [
                    { el: 'H', n: 1, ox: 1, cpk: 'H' },
                    { el: 'N', n: 1, ox: 5, cpk: 'N' },
                    { el: 'O', n: 3, ox: -2, cpk: 'O' }
                ],
                hint: 'Waterstof (H) is +I, Zuurstof (O) is -II.'
            },
            {
                id: 'kmno4',
                formula: <span>KMnO<sub>4</sub></span>,
                plainFormula: 'KMnO4',
                name: 'Kaliumpermanganaat',
                charge: 0,
                atoms: [
                    { el: 'K', n: 1, ox: 1, cpk: 'K' },
                    { el: 'Mn', n: 1, ox: 7, cpk: 'Mn' },
                    { el: 'O', n: 4, ox: -2, cpk: 'O' }
                ],
                hint: 'Kalium (K) staat in groep 1 en is dus +I.'
            },
            {
                id: 'fe2o3',
                formula: <span>Fe<sub>2</sub>O<sub>3</sub></span>,
                plainFormula: 'Fe2O3',
                name: 'IJzer(III)oxide',
                charge: 0,
                atoms: [
                    { el: 'Fe', n: 2, ox: 3, cpk: 'Fe' },
                    { el: 'O', n: 3, ox: -2, cpk: 'O' }
                ],
                hint: 'Zuurstof (O) is -II. Bereken Fe.'
            },
            // Ionen
            {
                id: 'so4',
                formula: <span>SO<sub>4</sub><sup>2-</sup></span>,
                plainFormula: 'SO4 2-',
                name: 'Sulfaat-ion',
                charge: -2,
                atoms: [
                    { el: 'S', n: 1, ox: 6, cpk: 'S' },
                    { el: 'O', n: 4, ox: -2, cpk: 'O' }
                ],
                hint: 'Let op: de totale lading is -2.'
            },
            {
                id: 'no3',
                formula: <span>NO<sub>3</sub><sup>-</sup></span>,
                plainFormula: 'NO3 -',
                name: 'Nitraat-ion',
                charge: -1,
                atoms: [
                    { el: 'N', n: 1, ox: 5, cpk: 'N' },
                    { el: 'O', n: 3, ox: -2, cpk: 'O' }
                ],
                hint: 'Let op: de totale lading is -1.'
            },
            {
                id: 'nh4',
                formula: <span>NH<sub>4</sub><sup>+</sup></span>,
                plainFormula: 'NH4 +',
                name: 'Ammonium-ion',
                charge: 1,
                atoms: [
                    { el: 'N', n: 1, ox: -3, cpk: 'N' },
                    { el: 'H', n: 4, ox: 1, cpk: 'H' }
                ],
                hint: 'Waterstof (H) is +I. Totale lading is +1.'
            },
            {
                id: 'cr2o7',
                formula: <span>Cr<sub>2</sub>O<sub>7</sub><sup>2-</sup></span>,
                plainFormula: 'Cr2O7 2-',
                name: 'Dichromaat-ion',
                charge: -2,
                atoms: [
                    { el: 'Cr', n: 2, ox: 6, cpk: 'Cr' },
                    { el: 'O', n: 7, ox: -2, cpk: 'O' }
                ],
                hint: 'Zuurstof (O) is -II. Totale lading is -2.'
            }
        ];

        // --- Components ---

        const StatusIcon = ({ status }) => {
            if (status === 'correct') {
                return (
                    <svg className="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M5 13l4 4L19 7" />
                    </svg>
                );
            }
            if (status === 'incorrect') {
                return (
                    <svg className="w-6 h-6 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                );
            }
            return null;
        };

        const App = () => {
            const [currentCompound, setCurrentCompound] = useState(COMPOUNDS[0]);
            const [inputs, setInputs] = useState({});
            const [validationState, setValidationState] = useState({ checked: false, correct: false, errors: {} });
            const [showHint, setShowHint] = useState(false);

            const reset = (comp) => {
                setCurrentCompound(comp);
                setInputs({});
                setValidationState({ checked: false, correct: false, errors: {} });
                setShowHint(false);
            };

            const handleInputChange = (idx, field, value) => {
                setInputs(prev => ({ ...prev, [`${idx}_${field}`]: value }));
                // Clear validation state on input to encourage retry
                if (validationState.checked) {
                    setValidationState(prev => ({ ...prev, checked: false }));
                }
            };

            const checkAnswers = () => {
                const errors = {};
                let allCorrect = true;
                let totalSum = 0;

                currentCompound.atoms.forEach((atom, idx) => {
                    const inputOxStr = inputs[`${idx}_ox`];
                    const inputNStr = inputs[`${idx}_n`];

                    const inputOx = fromRoman(inputOxStr);
                    const inputN = parseInt(inputNStr);

                    // Check Oxidation Number
                    if (inputOx !== atom.ox) {
                        errors[`${idx}_ox`] = true;
                        allCorrect = false;
                    }

                    // Check Count (n)
                    if (inputN !== atom.n) {
                        errors[`${idx}_n`] = true;
                        allCorrect = false;
                    }

                    if (inputOx !== null && !isNaN(inputN)) {
                        totalSum += inputOx * inputN;
                    }
                });

                setValidationState({
                    checked: true,
                    correct: allCorrect,
                    errors: errors,
                    totalSum: totalSum
                });
            };

            // Calculate live totals for display
            const currentTotals = currentCompound.atoms.map((atom, idx) => {
                const ox = fromRoman(inputs[`${idx}_ox`]);
                const n = parseInt(inputs[`${idx}_n`]);
                if (ox !== null && !isNaN(n)) return ox * n;
                return null;
            });
            const currentSum = currentTotals.reduce((acc, val) => acc + (val || 0), 0);

            return (
                <div className="w-full">
                    {/* Header */}
                    <header className="mb-12 text-center">
                        <h1 className="text-3xl font-bold text-gray-900 mb-2 tracking-tight">Oxidatiegetal Bepaler</h1>
                        <p className="text-gray-600 max-w-lg mx-auto">
                            Bepaal de oxidatiegetallen van elk atoom in de verbinding.
                            Gebruik Romeinse cijfers (bijv. <span className="font-mono text-sm bg-gray-100 px-1 rounded">II</span>, <span className="font-mono text-sm bg-gray-100 px-1 rounded">-II</span>) voor het oxidatiegetal.
                        </p>
                    </header>

                    {/* Navigation / Compound Selection */}
                    <nav className="mb-10 overflow-x-auto pb-4">
                        <div className="flex justify-center gap-2 min-w-max px-4">
                            {COMPOUNDS.map((comp) => (
                                <button
                                    key={comp.id}
                                    onClick={() => reset(comp)}
                                    className={`px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200 
                                        ${currentCompound.id === comp.id
                                            ? 'bg-blue-600 text-white shadow-sm'
                                            : 'bg-white text-gray-600 border border-gray-200 hover:bg-gray-50 hover:border-gray-300'
                                        }`}
                                >
                                    {comp.formula}
                                </button>
                            ))}
                        </div>
                    </nav>

                    {/* Main Workspace */}
                    <main className="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden max-w-3xl mx-auto">

                        {/* Compound Display */}
                        <div className="bg-gray-50 border-b border-gray-100 p-8 text-center">
                            <div className="text-5xl font-bold text-gray-900 mb-2 font-mono tracking-wide">
                                {currentCompound.formula}
                            </div>
                            <div className="text-gray-500 font-medium">{currentCompound.name}</div>

                            <div className="mt-6 inline-flex items-center gap-3 px-4 py-2 bg-white rounded-lg border border-gray-200 shadow-sm">
                                <span className="text-sm font-semibold text-gray-500 uppercase tracking-wider">Totale Lading</span>
                                <span className={`text-xl font-mono font-bold ${currentCompound.charge !== 0 ? 'text-blue-600' : 'text-gray-700'}`}>
                                    {currentCompound.charge > 0 ? '+' + currentCompound.charge : currentCompound.charge}
                                </span>
                            </div>
                        </div>

                        <div className="p-8">
                            {/* The Table */}
                            <div className="overflow-x-auto mb-8">
                                <table className="w-full border-collapse">
                                    <thead>
                                        <tr>
                                            <th className="p-4 text-left text-sm font-semibold text-gray-400 w-40">Atoomsoort</th>
                                            {currentCompound.atoms.map((atom, idx) => (
                                                <th key={idx} className="p-0 border-b-4 border-white">
                                                    <div className={`cpk-bg-${atom.cpk} py-3 px-4 text-xl font-bold rounded-t-lg mx-1 shadow-sm`}>
                                                        {atom.el}
                                                    </div>
                                                </th>
                                            ))}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {/* Row 1: Oxidatiegetal */}
                                        <tr>
                                            <td className="p-4 text-left font-medium text-gray-700">Oxidatiegetal (OG)</td>
                                            {currentCompound.atoms.map((atom, idx) => (
                                                <td key={idx} className="p-2 text-center">
                                                    <input
                                                        type="text"
                                                        placeholder="OG"
                                                        className={`input-cell w-24 text-center p-3 border rounded-lg font-mono font-bold text-lg outline-none uppercase
                                                            ${validationState.errors[`${idx}_ox`]
                                                                ? 'border-red-300 bg-red-50 text-red-700'
                                                                : 'border-gray-200 text-gray-800 focus:border-blue-500'
                                                            }
                                                        `}
                                                        value={inputs[`${idx}_ox`] || ''}
                                                        onChange={(e) => handleInputChange(idx, 'ox', e.target.value)}
                                                    />
                                                </td>
                                            ))}
                                        </tr>
                                        {/* Row 2: Aantal */}
                                        <tr>
                                            <td className="p-4 text-left font-medium text-gray-700">Aantal (n)</td>
                                            {currentCompound.atoms.map((atom, idx) => (
                                                <td key={idx} className="p-2 text-center">
                                                    <input
                                                        type="number"
                                                        placeholder="n"
                                                        className={`input-cell w-24 text-center p-3 border rounded-lg font-mono font-bold text-lg outline-none
                                                            ${validationState.errors[`${idx}_n`]
                                                                ? 'border-red-300 bg-red-50 text-red-700'
                                                                : 'border-gray-200 text-blue-600 focus:border-blue-500'
                                                            }
                                                        `}
                                                        value={inputs[`${idx}_n`] || ''}
                                                        onChange={(e) => handleInputChange(idx, 'n', e.target.value)}
                                                    />
                                                </td>
                                            ))}
                                        </tr>
                                        {/* Row 3: Totaal */}
                                        <tr>
                                            <td className="p-4 text-left font-medium text-gray-500 border-t border-gray-100">Totaal (OG × n)</td>
                                            {currentCompound.atoms.map((atom, idx) => (
                                                <td key={idx} className="p-4 text-center border-t border-gray-100">
                                                    <span className="font-mono text-lg font-bold text-gray-400">
                                                        {currentTotals[idx] !== null ? currentTotals[idx] : '—'}
                                                    </span>
                                                </td>
                                            ))}
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            {/* Feedback Section */}
                            <div className="flex flex-col md:flex-row gap-6 items-start justify-between">
                                <div className="flex-1 w-full">
                                    {/* Hint */}
                                    {showHint && (
                                        <div className="mb-4 p-4 bg-blue-50 text-blue-800 rounded-lg border border-blue-100 text-sm flex items-start gap-3">
                                            <svg className="w-5 h-5 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                            {currentCompound.hint}
                                        </div>
                                    )}

                                    {/* Success/Error Message */}
                                    {validationState.checked && (
                                        <div className={`p-4 rounded-lg border flex items-start gap-3 ${validationState.correct ? 'bg-green-50 border-green-200 text-green-800' : 'bg-red-50 border-red-200 text-red-800'}`}>
                                            <StatusIcon status={validationState.correct ? 'correct' : 'incorrect'} />
                                            <div>
                                                <p className="font-bold">{validationState.correct ? 'Correct!' : 'Nog niet helemaal.'}</p>
                                                <p className="text-sm mt-1">
                                                    {validationState.correct
                                                        ? `De som is ${validationState.totalSum}, wat overeenkomt met de lading.`
                                                        : 'Controleer de rood gemarkeerde velden. Kloppen de oxidatiegetallen en aantallen?'}
                                                </p>
                                            </div>
                                        </div>
                                    )}
                                </div>

                                {/* Action Buttons */}
                                <div className="flex flex-col gap-3 w-full md:w-auto min-w-[160px]">
                                    <button
                                        onClick={checkAnswers}
                                        className="w-full py-3 px-6 rounded-lg font-bold text-white bg-blue-600 hover:bg-blue-700 active:bg-blue-800 transition shadow-sm"
                                    >
                                        Controleer
                                    </button>
                                    <button
                                        onClick={() => setShowHint(!showHint)}
                                        className="w-full py-2 px-6 rounded-lg font-semibold text-blue-600 bg-transparent hover:bg-blue-50 transition border border-transparent hover:border-blue-100"
                                    >
                                        {showHint ? 'Verberg Hint' : 'Toon Hint'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>